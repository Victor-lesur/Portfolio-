<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio | Data & ERP Analyst</title>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { 
            animation: fadeIn 0.4s ease-out forwards; 
        }

        /* Optionnel : Amélioration du défilement des listes déroulantes */
        select {
            cursor: pointer;
        }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'apple-blue': '#0071e3',
                        'dark-bg': '#1a1a1a',
                        'light-text': '#f5f5f7',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-dark-bg text-light-text font-sans">

    <header class="bg-gray-800 shadow-lg p-8">
        <div class="max-w-6xl mx-auto text-center">
            <h1 class="text-4xl font-extrabold mb-2">VICTOR LESUR</h1>
            <p class="text-xl text-apple-blue mb-6">Foormation en Data Science</p>
        </div>

        <!-- Liens Essentiels (Boutons) -->

        <div class="flex flex-wrap justify-center gap-4">
            <a href="cv_page.html" class="group bg-apple-blue hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition-all duration-300 transform hover:-translate-y-1 hover:shadow-[0_0_20px_rgba(0,113,227,0.4)]">
                Voir le CV
            </a>
            
            <a href="https://www.linkedin.com/in/victor--lesur/" target="_blank" class="bg-gray-600 hover:bg-[#0077b5] text-white font-bold py-2 px-6 rounded-lg transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg">
                LinkedIn
            </a>
            
            <a href="contact.html" class="bg-apple-blue hover:bg-orange-500 text-white font-bold py-2 px-6 rounded-lg transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg">
                Contact
            </a>
            
            <a href="[GitHub]" target="_blank" class="bg-gray-600 hover:bg-[#333] text-white font-bold py-2 px-6 rounded-lg transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg">
                GitHub
            </a>
        </div>

    </header>


    <main class="max-w-6xl mx-auto p-8">
        
        <!-- BARRE DE FILTRES -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-12">
            <div>
                <label class="block text-sm font-medium mb-2 text-gray-400">Expérience</label>
                <select id="filter-exp" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 outline-none focus:ring-2 focus:ring-apple-blue">
                    <option value="all">Toutes les expériences</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2 text-gray-400">Projet spécifique</label>
                <select id="filter-proj" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 outline-none focus:ring-2 focus:ring-apple-blue">
                    <option value="all">Tous les projets</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2 text-gray-400">Compétence</label>
                <select id="filter-skill" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 outline-none focus:ring-2 focus:ring-apple-blue">
                    <option value="all">Toutes les compétences</option>
                </select>
            </div>
        </div>
        <div class="max-w-6xl mx-auto mb-8 flex justify-end">
            <button id="reset-btn" class="flex items-center gap-2 text-sm text-gray-400 hover:text-orange-400 transition-colors duration-300">
                <svg xmlns="www.w3.org" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                Réinitialiser les filtres
            </button>
        </div>

        <!-- ZONE DE RÉSULTATS DYNAMIQUE -->
        <section id="projets">
            <h2 class="text-3xl font-semibold mb-8 border-b border-gray-700 pb-2">Projets & Expériences</h2>
            <div id="experience-details" class="mb-10 transition-all duration-500"></div>
            <div id="results-container" class="space-y-8">
                <!-- Le JavaScript injectera les cartes ici -->
            </div>
        </section>

    </main>

    <script>
        let portfolioData = {};

        // Charger le fichier JSON
        async function init() {
            try {
                const response = await fetch('data.json');
                portfolioData = await response.json();
                
                setupFilters();
                render(); 
            } catch (e) {
                console.error("Erreur : Assurez-vous de lancer la page via un serveur (Live Server)", e);
            }
        }

        // Remplir les menus déroulants
        function setupFilters() {
            const fill = (id, items, key) => {
                const select = document.getElementById(id);
                // On vide et on met l'option par défaut
                select.innerHTML = `<option value="all">${id === 'filter-exp' ? 'Toutes les expériences' : id === 'filter-proj' ? 'Tous les projets' : 'Toutes les compétences'}</option>`;
                
                items.forEach(item => {
                    const opt = document.createElement('option');
                    opt.value = item.id;
                    opt.textContent = item[key] || item.nom || item.titre;
                    select.appendChild(opt);
                });
                select.addEventListener('change', render);
            };

            fill('filter-exp', portfolioData.experiences, 'titre');
            fill('filter-proj', portfolioData.projets, 'titre');
            fill('filter-skill', portfolioData.competences, 'nom');
        }

        // Afficher les cartes filtrées
        function render() {
            const fExp = document.getElementById('filter-exp').value;
            const fProjSelect = document.getElementById('filter-proj');
            const fSkillSelect = document.getElementById('filter-skill');
            
            // --- 1. LOGIQUE DE CASCADE (MASQUAGE) ---
            // On détermine quels projets sont valides pour l'expérience choisie
            const validProjs = portfolioData.projets.filter(p => fExp === 'all' || p.exp_id === fExp);
            const validProjIds = validProjs.map(p => p.id);
            const validSkillIds = [...new Set(validProjs.flatMap(p => p.skills))];

            // Masquer/Afficher les options du menu PROJETS
            Array.from(fProjSelect.options).forEach(opt => {
                if (opt.value === 'all') return;
                opt.style.display = validProjIds.includes(opt.value) ? 'block' : 'none';
            });

            // Masquer/Afficher les options du menu COMPÉTENCES
            Array.from(fSkillSelect.options).forEach(opt => {
                if (opt.value === 'all') return;
                opt.style.display = validSkillIds.includes(opt.value) ? 'block' : 'none';
            });

            // Si l'élément sélectionné est maintenant masqué, on remet à "all"
            if (fProjSelect.options[fProjSelect.selectedIndex].style.display === 'none') fProjSelect.value = 'all';
            if (fSkillSelect.options[fSkillSelect.selectedIndex].style.display === 'none') fSkillSelect.value = 'all';

            // --- 2. APPEL DU RENDU VISUEL ---
            const container = document.getElementById('results-container');
            const expDetailsContainer = document.getElementById('experience-details');
            container.innerHTML = '';
            expDetailsContainer.innerHTML = '';

            if (fExp === 'all' && fProjSelect.value === 'all' && fSkillSelect.value === 'all') {
                renderPanorama(container);
            } else {
                renderFilteredView(fExp, fProjSelect.value, fSkillSelect.value, container, expDetailsContainer);
            }
        }

        // --- FONCTION POUR LE MODE PANORAMA ---
        function renderPanorama(container) {
            container.innerHTML = `<h2 class="text-2xl font-bold mb-6 text-gray-400">Vue d'ensemble de mon parcours</h2>`;
            
            portfolioData.experiences.forEach(exp => {
                // On récupère les projets et compétences liés à cette expérience
                const projects = portfolioData.projets.filter(p => p.exp_id === exp.id);
                const skillIds = [...new Set(projects.flatMap(p => p.skills))];
                const skills = portfolioData.competences.filter(c => skillIds.includes(c.id));

                container.innerHTML += `
                    <div class="bg-gray-800/50 p-8 rounded-2xl border border-gray-700 mb-8 hover:border-apple-blue transition-all">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-2xl font-bold text-white">${exp.titre}</h3>
                            <span class="text-apple-blue font-mono">${exp.periode || ''}</span>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mt-6">
                            <!-- Liste des projets -->
                            <div>
                                <p class="text-sm text-gray-500 uppercase mb-3">Projets réalisés :</p>
                                <ul class="space-y-2">
                                    ${projects.map(p => `
                                        <li class="flex items-center text-gray-300">
                                            <span class="w-2 h-2 bg-apple-blue rounded-full mr-3"></span>
                                            ${p.titre}
                                        </li>
                                    `).join('')}
                                </ul>
                            </div>
                            
                            <!-- Liste des compétences -->
                            <div>
                                <p class="text-sm text-gray-500 uppercase mb-3">Compétences clés :</p>
                                <div class="flex flex-wrap gap-2">
                                    ${skills.map(s => `
                                        <span class="bg-gray-900 text-gray-400 text-[10px] px-2 py-1 rounded border border-gray-700">
                                            ${s.nom}
                                        </span>
                                    `).join('')}
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
        }
        function renderFilteredView(fExp, fProj, fSkill, container, expDetailsContainer) {
            const fExpSelect = document.getElementById('filter-exp');
            const fProjSelect = document.getElementById('filter-proj');
            const fSkillSelect = document.getElementById('filter-skill');

            // --- 2. FILTRAGE EN CASCADE POUR PROJETS ET COMPÉTENCES ---
            // On définit quels projets sont éligibles selon l'expérience choisie
            const validProjs = portfolioData.projets.filter(p => fExp === 'all' || p.exp_id === fExp);
            const validSkillIds = [...new Set(validProjs.flatMap(p => p.skills))];

            // Reconstruction du menu Projets
            fProjSelect.innerHTML = '<option value="all">Tous les projets</option>';
            validProjs.forEach(p => {
                const opt = document.createElement('option');
                opt.value = p.id;
                opt.textContent = p.titre;
                opt.selected = (p.id === fProj);
                fProjSelect.appendChild(opt);
            });

            // Reconstruction du menu Compétences
            fSkillSelect.innerHTML = '<option value="all">Toutes les compétences</option>';
            portfolioData.competences.filter(c => validSkillIds.includes(c.id)).forEach(c => {
                const opt = document.createElement('option');
                opt.value = c.id;
                opt.textContent = c.nom;
                opt.selected = (c.id === fSkill);
                fSkillSelect.appendChild(opt);
            });

            // --- 3. AFFICHAGE DES DÉTAILS (Inchangé) ---
            if (fExp !== 'all') {
                const selectedExp = portfolioData.experiences.find(e => e.id === fExp);
                if (selectedExp) {
                    expDetailsContainer.innerHTML = `
                        <div class="bg-gradient-to-r from-gray-800 to-gray-900 p-8 rounded-2xl border border-apple-blue/30 shadow-2xl animate-fade-in mb-10">
                            <h2 class="text-3xl font-extrabold text-white">${selectedExp.titre}</h2>
                            <p class="text-apple-blue mb-4">${selectedExp.periode || ''}</p>
                            <p class="text-gray-300 italic">"${selectedExp.details || ''}"</p>
                        </div>`;
                }
            }

            // --- 4. AFFICHAGE DES CARTES (On utilise fProj et fSkill mis à jour) ---
            const finalProj = fProjSelect.value;
            const finalSkill = fSkillSelect.value;

            validProjs.forEach(proj => {
                const matchProj = (finalProj === 'all' || proj.id === finalProj);
                const matchSkill = (finalSkill === 'all' || proj.skills.includes(finalSkill));

                if (matchProj && matchSkill) {
                    // ... Votre code de génération de carte projet (Inchangé) ...
                    const isExpHighlighted = (fExp !== 'all' && proj.exp_id === fExp);
                    container.innerHTML += `
                        <div class="bg-gray-800 p-6 rounded-xl border-l-4 ${isExpHighlighted ? 'border-orange-500' : 'border-apple-blue'} shadow-lg animate-fade-in mb-6">
                            <h3 class="text-xl font-bold">${proj.titre}</h3>
                            <p class="text-gray-400 text-sm mt-2">${proj.description}</p>
                        </div>`;
                }
            });
        }


        init();
    </script>
</body>
</html>