<!DOCTYPE html>
<html lang="fr" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portfolio | Data & ERP Analyst</title>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { 
            animation: fadeIn 0.4s ease-out forwards; 
        }

        /* Optionnel : Amélioration du défilement des listes déroulantes */
        select {
            cursor: pointer;
        }
    </style>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'apple-blue': '#0071e3',
                        'dark-bg': '#1a1a1a',
                        'light-text': '#f5f5f7',
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-dark-bg text-light-text font-sans">

    <header class="bg-gray-800 shadow-lg p-8">
        <div class="max-w-6xl mx-auto text-center">
            <h1 class="text-4xl font-extrabold mb-2">VICTOR LESUR</h1>
            <p class="text-xl text-apple-blue mb-6">Foormation en Data Science</p>
        </div>

        <!-- Liens Essentiels (Boutons) -->

        <div class="flex flex-wrap justify-center gap-4">
            <a href="cv_page.html" class="group bg-apple-blue hover:bg-blue-600 text-white font-bold py-2 px-6 rounded-lg transition-all duration-300 transform hover:-translate-y-1 hover:shadow-[0_0_20px_rgba(0,113,227,0.4)]">
                Voir le CV
            </a>
            
            <a href="https://www.linkedin.com/in/victor--lesur/" target="_blank" class="bg-gray-600 hover:bg-[#0077b5] text-white font-bold py-2 px-6 rounded-lg transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg">
                LinkedIn
            </a>
            
            <a href="contact.html" class="bg-apple-blue hover:bg-orange-500 text-white font-bold py-2 px-6 rounded-lg transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg">
                Contact
            </a>
            
            <a href="[GitHub]" target="_blank" class="bg-gray-600 hover:bg-[#333] text-white font-bold py-2 px-6 rounded-lg transition-all duration-300 transform hover:-translate-y-1 hover:shadow-lg">
                GitHub
            </a>
        </div>

    </header>


    <main class="max-w-6xl mx-auto p-8">
        
        <!-- BARRE DE FILTRES -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-12">
            <div>
                <label class="block text-sm font-medium mb-2 text-gray-400">Expérience</label>
                <select id="filter-exp" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 outline-none focus:ring-2 focus:ring-apple-blue">
                    <option value="all">Toutes les expériences</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2 text-gray-400">Projet spécifique</label>
                <select id="filter-proj" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 outline-none focus:ring-2 focus:ring-apple-blue">
                    <option value="all">Tous les projets</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium mb-2 text-gray-400">Compétence</label>
                <select id="filter-skill" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 outline-none focus:ring-2 focus:ring-apple-blue">
                    <option value="all">Toutes les compétences</option>
                </select>
            </div>
        </div>
        <div class="max-w-6xl mx-auto mb-8 flex justify-end">
            <button id="reset-btn" class="flex items-center gap-2 text-sm text-gray-400 hover:text-orange-400 transition-colors duration-300">
                <svg xmlns="www.w3.org" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                Réinitialiser les filtres
            </button>
        </div>

        <!-- ZONE DE RÉSULTATS DYNAMIQUE -->
        <section id="projets">
            <h2 class="text-3xl font-semibold mb-8 border-b border-gray-700 pb-2">Projets & Expériences</h2>
            <div id="experience-details" class="mb-10 transition-all duration-500"></div>
            <div id="results-container" class="space-y-8">
                <!-- Le JavaScript injectera les cartes ici -->
            </div>
        </section>

    </main>

<script>
    let portfolioData = {};

    async function init() {
        try {
            const response = await fetch('data.json');
            portfolioData = await response.json();
            setupFilters();
            // Initialisation du bouton Reset
            document.getElementById('reset-btn').addEventListener('click', resetAllFilters);
            render(); 
        } catch (e) {
            console.error("Erreur de chargement JSON", e);
        }
    }

    function setupFilters() {
        // On remplit les menus une seule fois au démarrage
        const fill = (id, items, key) => {
            const select = document.getElementById(id);
            items.forEach(item => {
                const opt = document.createElement('option');
                opt.value = item.id;
                opt.textContent = item[key] || item.nom || item.titre;
                select.appendChild(opt);
            });
            select.addEventListener('change', render);
        };

        fill('filter-exp', portfolioData.experiences, 'titre');
        fill('filter-proj', portfolioData.projets, 'titre');
        fill('filter-skill', portfolioData.competences, 'nom');
    }

    function resetAllFilters() {
        document.getElementById('filter-exp').value = 'all';
        document.getElementById('filter-proj').value = 'all';
        document.getElementById('filter-skill').value = 'all';
        render();
    }

    function render() {
        const fExp = document.getElementById('filter-exp').value;
        const fProjSelect = document.getElementById('filter-proj');
        const fSkillSelect = document.getElementById('filter-skill');
        const container = document.getElementById('results-container');
        const expDetailsContainer = document.getElementById('experience-details');

        // --- 1. LOGIQUE DE CASCADE (DÉSACTIVATION DES OPTIONS) ---
        const validProjs = portfolioData.projets.filter(p => fExp === 'all' || p.exp_id === fExp);
        const validProjIds = validProjs.map(p => p.id);
        const validSkillIds = [...new Set(validProjs.flatMap(p => p.skills))];

        // Pour les projets : on désactive et on cache les options non reliées
        Array.from(fProjSelect.options).forEach(opt => {
            if (opt.value === 'all') return;
            const isValid = validProjIds.includes(opt.value);
            opt.disabled = !isValid;
            opt.hidden = !isValid; // Meilleur support que display:none
        });

        // Pour les compétences
        Array.from(fSkillSelect.options).forEach(opt => {
            if (opt.value === 'all') return;
            const isValid = validSkillIds.includes(opt.value);
            opt.disabled = !isValid;
            opt.hidden = !isValid;
        });

        // Sécurité : si la sélection actuelle devient invalide, on reset à "all"
        if (fProjSelect.options[fProjSelect.selectedIndex].disabled) fProjSelect.value = 'all';
        if (fSkillSelect.options[fSkillSelect.selectedIndex].disabled) fSkillSelect.value = 'all';

        // Nettoyage des zones de rendu
        container.innerHTML = '';
        expDetailsContainer.innerHTML = '';

        // --- 2. CHOIX DU MODE D'AFFICHAGE ---
        if (fExp === 'all' && fProjSelect.value === 'all' && fSkillSelect.value === 'all') {
            renderPanorama(container);
        } else {
            renderFilteredView(fExp, fProjSelect.value, fSkillSelect.value, container, expDetailsContainer);
        }
    }

    function renderPanorama(container) {
        container.innerHTML = `<h2 class="text-2xl font-bold mb-6 text-gray-400">Vue d'ensemble de mon parcours</h2>`;
        portfolioData.experiences.forEach(exp => {
            const projects = portfolioData.projets.filter(p => p.exp_id === exp.id);
            const skillIds = [...new Set(projects.flatMap(p => p.skills))];
            const skills = portfolioData.competences.filter(c => skillIds.includes(c.id));

            container.innerHTML += `
                <div class="bg-gray-800/50 p-8 rounded-2xl border border-gray-700 mb-8 animate-fade-in">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-white">${exp.titre}</h3>
                        <span class="text-apple-blue font-mono">${exp.periode || ''}</span>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <p class="text-xs text-gray-500 uppercase mb-3 tracking-widest">Projets</p>
                            <ul class="space-y-2 text-gray-300">
                                ${projects.map(p => `<li class="flex items-center"><span class="w-1.5 h-1.5 bg-apple-blue rounded-full mr-2"></span>${p.titre}</li>`).join('')}
                            </ul>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500 uppercase mb-3 tracking-widest">Compétences clés</p>
                            <div class="flex flex-wrap gap-2">
                                ${skills.map(s => `<span class="bg-gray-900 text-gray-400 text-[10px] px-2 py-1 rounded border border-gray-700">${s.nom}</span>`).join('')}
                            </div>
                        </div>
                    </div>
                </div>`;
        });
    }

    function renderFilteredView(fExp, fProj, fSkill, container, expDetailsContainer) {
        if (fExp !== 'all') {
            const exp = portfolioData.experiences.find(e => e.id === fExp);
            expDetailsContainer.innerHTML = `
                <div class="bg-gradient-to-r from-gray-800 to-gray-900 p-8 rounded-2xl border border-apple-blue/30 animate-fade-in">
                    <h2 class="text-3xl font-extrabold text-white">${exp.titre}</h2>
                    <p class="text-apple-blue mt-1">${exp.periode || ''}</p>
                    <p class="text-gray-300 mt-4 italic">"${exp.details || ''}"</p>
                </div>`;
        }

        portfolioData.projets.forEach(proj => {
            const matchExp = (fExp === 'all' || proj.exp_id === fExp);
            const matchProj = (fProj === 'all' || proj.id === fProj);
            const matchSkill = (fSkill === 'all' || proj.skills.includes(fSkill));

            if (matchExp && matchProj && matchSkill) {
                const expName = portfolioData.experiences.find(e => e.id === proj.exp_id)?.titre || "";
                const isSelectedSkill = (fSkill !== 'all');

                container.innerHTML += `
                    <div class="bg-gray-800 p-6 rounded-xl border-l-4 ${fExp !== 'all' ? 'border-orange-500' : 'border-apple-blue'} shadow-lg animate-fade-in">
                        <span class="text-xs font-bold uppercase ${fExp !== 'all' ? 'text-orange-400' : 'text-apple-blue'}">${expName}</span>
                        <h3 class="text-2xl font-bold mt-1 mb-3">${proj.titre}</h3>
                        <p class="text-gray-300 mb-6 leading-relaxed">${proj.description.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')}</p>
                        <div class="flex flex-wrap gap-2">
                            ${proj.skills.map(s => {
                                const sk = portfolioData.competences.find(c => c.id === s);
                                const highlight = (fSkill !== 'all' && s === fSkill);
                                return `<span class="text-xs px-3 py-1 rounded-full border ${highlight ? 'bg-orange-500 text-white border-orange-400 scale-105' : 'bg-blue-900/30 text-apple-blue border-apple-blue/20'}">${sk.nom}</span>`;
                            }).join('')}
                        </div>
                    </div>`;
            }
        });
    }

    init();
</script>
</body>
</html>